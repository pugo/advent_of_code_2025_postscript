%!PS-Adobe-3.0
%%BoundingBox: 24 24 571 818
%%Title: Advent of Code 2025 - day 
%%For: Hackvalue
%%Creator: Anders Piniesjö
%%CreationDate: Sat Dec 06 22:29:41 2025
%%Orientation: Portrait
%%DocumentMedia: A4 595 842 0 () ()
%%EndComments

% -----------------------------------------------------------------------
%  Advent of Code 2025 in Postscript - Day 2
%  by Anders Piniesjö
%
%  Run with: ghostscript 2.ps
%  
%  -- Or print it on a Postscript printer!
% -----------------------------------------------------------------------

%% ----- Data -------

/ranges [
% <<INJECT DATA HERE>>
] def


%% ----- Output -------

/setup_output
{
   /stdout (%stdout) (w) file def
   /print { stdout exch writestring } bind def
   /println { print stdout (\n) writestring } bind def

   /LM   50 def      % Left margin
   /RM   578 def     % Right margin
   /TM   700 def     % Top margin
   /BM   10 def      % Bottom margin
   /fontsize 18 def  % Change this to change font-size
   /ypos TM def      % current y-position
   /lineheight fontsize def

   /font_normal /Times-Roman findfont fontsize scalefont def
   /font_bold /Times-Bold findfont fontsize scalefont def
   font_normal setfont
} def

/newline
 { currentpoint exch pop lineheight sub  % calc y-val
   BM lt                                 % check if less than bottom margin
   { showpage LM TM moveto               % New page
     /ypos TM def }
   { ypos lineheight sub                 % Go left/down
     /ypos exch def
     LM ypos moveto } ifelse
} def
   
/prtstr
 { dup stringwidth pop      % calc length of string
   currentpoint pop         % get horizontal position
   add RM gt                % sum > right margin?
   {newline} if             % if so, next line
   show 
} def

/setnormal { font_normal setfont } bind def
/setbold { font_bold setfont } bind def

%% ---- Utils ------

/is_even  % int - bool
{
   2 mod 0 eq
} bind def

%% ----- step 1 -------

/check_number  % int -- 
{
   dup 100 string cvs   % leaves  <int> <string> 
   dup length is_even 
   {
      dup /plen exch length 2 idiv def             % store half strlength
      dup 0 plen getinterval /str_start exch def   % store first half
      dup plen plen getinterval /str_end exch def  % store second half

      str_start str_end eq 
      {
         pop
         dup /sum_invalid exch sum_invalid add def
      }
      {
         pop
      } ifelse
   }
   {
      pop
   } ifelse

   pop
} def

/handle_ranges_step_1
{
   /sum_invalid 0 def

   ranges
   {
      /pair exch def
      pair 0 get /start exch def
      pair 1 get /end exch def

      start 1 end 
      { 
         check_number
      } for
   } forall
} def

%% ----- step 2 -------

/check_number_step_2  % int -- bool
{
   /num exch def
   /str num 32 string cvs def   % convert to string
   /slen str length cvi def     % store strlength

   /res false def           

   num 1 gt
   {
      1 1 slen 2 idiv           % try all lengths: 1 .. slen/2
      {
         /unitlen exch def

         slen unitlen mod 0 ne 
         {
            % slen not dividable by unitlen
         }
         {
            str 0 unitlen getinterval /unit exch def
            
            /ok true def
            /i unitlen def

            {
               i slen ge { exit } if
               
               str i unitlen getinterval unit eq not 
               {
                  /ok false def
                  exit
               } if

               /i i unitlen add def
            } loop

            ok 
            {
               /res true def
               %stdout str writestring stdout (\n) writestring
            } if
         } ifelse
      } for
   } if

   res
} def

/handle_ranges_step_2
{
   /sum_invalid_step_2 0 def

   ranges
   {
      /pair exch def
      pair 0 get /start exch def
      pair 1 get /end exch def

      start 1 end 
      {  % for  <int>
         dup check_number_step_2
         {
            /sum_invalid_step_2 exch sum_invalid_step_2 add def
         }
         {
            pop
         } ifelse
      } for
   } forall
} def

%% ------------------------------

setup_output
handle_ranges_step_1
handle_ranges_step_2

LM TM moveto
setbold (Advent of Code 2025) prtstr setnormal newline newline
(- Day 2 -) prtstr 1 1 6 { pop newline } for
setbold (Result Step 1: ) prtstr setnormal sum_invalid 100 string cvs prtstr newline newline
setbold (Result Step 2: ) prtstr setnormal sum_invalid_step_2 100 string cvs prtstr newline

% Write to stdout as well
(\nAdvent of Code 2025  - Day 2 - Anders Piniesjö\n) println 
(Step 1: ) print sum_invalid 20 string cvs println
(Step 2: ) print sum_invalid_step_2 20 string cvs println
