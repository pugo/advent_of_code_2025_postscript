%!PS-Adobe-3.0
%%BoundingBox: 24 24 571 818
%%Title: Advent of Code 2025 - day 7
%%For: Hackvalue
%%Creator: Anders Piniesjö
%%CreationDate: Mon Dec 13 22:47:41 2025
%%Orientation: Portrait
%%DocumentMedia: A4 595 842 0 () ()
%%EndComments

% -----------------------------------------------------------------------
%  Advent of Code 2025 in Postscript - Day 7
%  by Anders Piniesjö
%
%  Run with: ghostscript 7.ps
%  
%  -- Or print it on a Postscript printer!
% -----------------------------------------------------------------------

%% ----- Data -------

/input_data [
% <<INJECT DATA HERE>>
] bind def

%% ----- Output -------

/setup_output
{
   /stdout (%stdout) (w) file def
   /print { stdout exch writestring } bind def
   /println { print stdout (\n) writestring } bind def

   /LM   50 def      % Left margin
   /RM   578 def     % Right margin
   /TM   700 def     % Top margin
   /BM   10 def      % Bottom margin
   /fontsize 18 def  % Change this to change font-size
   /ypos TM def      % current y-position
   /lineheight fontsize def

   /font_normal /Times-Roman findfont fontsize scalefont def
   /font_bold /Times-Bold findfont fontsize scalefont def
   font_normal setfont
} def

/newline
 { currentpoint exch pop lineheight sub  % calc y-val
   BM lt                                 % check if less than bottom margin
   { showpage LM TM moveto               % New page
     /ypos TM def }
   { ypos lineheight sub                 % Go left/down
     /ypos exch def
     LM ypos moveto } ifelse
} def
   
/prtstr
 { dup stringwidth pop      % calc length of string
   currentpoint pop         % get horizontal position
   add RM gt                % sum > right margin?
   {newline} if             % if so, next line
   show 
} def

/setnormal { font_normal setfont } bind def
/setbold { font_bold setfont } bind def

%% ---- Utils ------

/max  %% int int -- int   | Return max of two ints
{
   2 copy lt { exch pop } { pop } ifelse
} bind def

/append   %% array elem -- array with elem   | Append elem to array, returning a new array with result.
{
   1 index length dup 1 add array   % Create new larger array.
   dup 0 6 -1 roll putinterval      % Copy old array into new.
   dup 4 -2 roll                    % Duplicate array and stack roll.
   exch put                         % Put element to end.
} bind def

/deep_copy_stringarray  %% array -- array   | Deep copy an array of strings.
{
   /old exch def
   /new old length array def

   0 1 old length 1 sub
   {                       % i
      dup old exch get     % i str
      dup length string    % i str newstr
      0 3 -1 roll          % i newstr 0 str
      dup length 0 exch    % i newstr 0 str 0 slen
      getinterval          % i newstr 0 str
      2 index              % i newstr 0 str newstr
      5 1 roll             % newstr i newstr 0 str
      putinterval          % newstr i
      new exch 3 -1 roll   % new i 
      put    
   } for
   new
} bind def

%% ----- Input conversion -------

/cS (S) 0 get def
/cDot (.) 0 get def
/cBeam (|) 0 get def
/cSplit (^) 0 get def

/ops <<
   cS { y 1 add x set_beam  }
   cDot { }
   cBeam { y 1 add x set_beam }
   cSplit { }
>> def

/set_beam   %% y x --
{
   2 copy               % y x y x
   input 3 -1 roll get  % Get row.
   exch get             % Get char.

   dup cDot eq
   {
      input     % y x cDot input
      4 -1 roll get
      3 -1 roll cBeam put
      pop
   }
   {
      dup cSplit eq
      {
         input     % y x cSplit input
         4 -1 roll get
         dup
         3 index 1 sub cBeam put 
         3 -1 roll 1 add cBeam put
         /splitcount splitcount 1 add def
         pop
      }
      {
        pop pop pop
      } ifelse
   } ifelse
} bind def

/beam  %% array[str] -- int   | Step 1, count number of splits. Will mutate the input array.
{
   /input exch def
   /height input length def
   /width input 0 get length def
   /splitcount 0 def

   0 1 height 2 sub
   {
      /y exch def

      0 1 width 1 sub
      {
         /x exch def

         input y get x get
         dup ops exch known
         {
            ops exch get exec
         }
         { pop } ifelse
      } for
   } for

   splitcount
} bind def

/init_count  %% str -- array   | return array with same length, with 1 at S.
{
   /is exch def
   /oa is length array def

   0 1 is length 1 sub
   {
      /z exch def
      is z get cS eq
      { oa z 1 put }
      { oa z 0 put } ifelse
   } for
   oa
} bind def

/zero_array  %% n -- array   | Crate array with n number of 0.
{
   dup array exch   % array n
   0 1 3 -1 roll 1 sub
   {  % array i
      2 copy 0 put   % array i
      pop
   } for
} bind def

/quantum_beam  %% array[str] -- int
{
   /input exch def
   /height input length def
   /width input 0 get length def

   /count_array input 0 get init_count def

   1 1 height 1 sub  %% for height
   {
      /qy exch def
      /new_count width zero_array def

      input qy get /row exch def

      0 1 row length 1 sub          % for width
      {
         /qx exch def
         row qx get

         dup cDot eq
         {
            new_count qx 
            new_count qx get
            count_array qx get add put
         }
         {
            dup cSplit eq
            {
               new_count qx 1 sub
               new_count qx 1 sub get
               count_array qx get add put

               new_count qx 1 add
               new_count qx 1 add get
               count_array qx get add put
            }
            {
            } ifelse
         } ifelse
         pop

      } for
      /count_array new_count def
   } for

   0 count_array
   {
      add
   } forall
} bind def


%% ------------------------------

setup_output

input_data deep_copy_stringarray /step1_data exch def
input_data deep_copy_stringarray /step2_data exch def

step1_data beam /result_step_1 exch def

step1_data { println } forall

step2_data quantum_beam /step_2_answer exch def

% Output to paper
LM TM moveto
setbold (Advent of Code 2025) prtstr setnormal newline newline
(- Day 7 -) prtstr 1 1 6 { pop newline } for
setbold (Sum step 1: ) prtstr setnormal result_step_1 100 string cvs prtstr newline newline
setbold (Sum step 2: ) prtstr setnormal step_2_answer 100 string cvs prtstr newline

% Write to stdout as well
(\nAdvent of Code 2025  - Day 7 - Anders Piniesjö\n) println 
(Sum step 1: ) print result_step_1 20 string cvs println
(Sum step 2: ) print step_2_answer 20 string cvs println
